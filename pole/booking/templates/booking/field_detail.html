{% extends 'base.html' %}
{% load static %}
{% block title %}
{% endblock title %}


{% block main %}
<header class="header container">
    {% for message in messages %}
        <div class="message {{ message.tags }}">
            {{ message }}
        </div>
    {% endfor %}
    <div class="detail__content">
        {% include 'booking/components/_field_slider.html' %}

        <div class="detail__content__text">
            <h3 class="detail__content__title">{{ field.title}}</h3>
            <a href="{{ field.adress_url }}" class="detail__content__location">
                <svg viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                            d="M14.2235 1.41412L2.30455 7.77091C1.49524 8.20254 1.64548 9.40504 2.53612 9.62428L6.24914 10.5382C6.62016 10.6296 6.90671 10.9244 6.98751 11.2978L7.81139 15.106C8.01376 16.0414 9.28805 16.1855 9.69424 15.319L15.5996 2.7209C16.0077 1.85029 15.0719 0.961639 14.2235 1.41412Z"/>
                </svg>
                <span>{{ field.region }} район, {{ field.adress }}</span>
            </a>
            <div class="detail__content__size">
                <svg viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                            d="M7.93421 7.93421L1 1M1 1V6.36842M1 1H6.36842M7.93421 11.0658L1 18M1 18V12.6316M1 18H6.36842M11.0658 11.0658L18 18M18 18H12.6316M18 18V12.6316M11.0658 7.93421L18 1M18 1H12.6316M18 1V6.36842"/>
                </svg>
                <span>Длина: {{ field.lenght }} метров; Ширина: {{ field.width }} метров</span>
            </div>
            <div class="detail__content__benefits">
                <div class="detail__content__benefits__projector">
                    <svg class="icon-projector" width="24" height="20" viewBox="0 0 24 20" fill="none"
                         xmlns="http://www.w3.org/2000/svg">
                        <path
                                d="M18.8303 17.6143C18.8303 18.3796 15.8929 19 12.2694 19C8.64597 19 5.70856 18.3796 5.70856 17.6143M18.8303 17.6143C18.8303 16.849 15.8929 16.2286 12.2694 16.2286C8.64597 16.2286 5.70856 16.849 5.70856 17.6143M18.8303 17.6143L14.1783 6.01964M5.70856 17.6143C7.52528 13.0863 8.54385 10.5476 10.3606 6.01964M11.1665 3.94108H11.11C10.657 3.94108 10.2899 4.30826 10.2899 4.76119V4.76119C10.2899 5.21413 10.657 5.5813 11.11 5.5813H13.3582C13.8111 5.5813 14.1783 5.21413 14.1783 4.76119V4.76119C14.1783 4.30826 13.8111 3.94108 13.3582 3.94108H13.3441M11.1665 3.94108V2.08877C11.1665 1.48746 11.654 1 12.2553 1V1C12.8566 1 13.3441 1.48746 13.3441 2.08877V3.94108M11.1665 3.94108H13.3441M2.8806 8.06991L5.59544 16.2286M9.00314 7.51846L7.73763 6.62765L6.47211 5.73684M2.59098 5.5813V5.5813C2.18966 5.82279 2.06211 6.34511 2.30696 6.74439L2.31831 6.76291C2.57231 7.17713 3.11766 7.30076 3.52546 7.03658L5.32882 5.86832C5.71665 5.61707 5.82418 5.09722 5.56785 4.71273V4.71273C5.32217 4.34421 4.82688 4.2359 4.44737 4.46426V4.46426M2.59098 5.5813L1.61039 4.07361C1.27515 3.55816 1.42813 2.86794 1.94977 2.5424V2.5424C2.46406 2.22145 3.14113 2.37768 3.4628 2.89152L4.44737 4.46426M2.59098 5.5813L4.44737 4.46426M15.5782 7.51846C16.5776 6.8227 17.138 6.43261 18.1375 5.73684M21.6724 8.12647L18.9434 16.3983M20.1312 4.37113V4.37113C19.7541 4.13217 19.2551 4.23861 19.0083 4.61063C18.9969 4.62769 18.9856 4.64472 18.9744 4.66174C18.7011 5.07359 18.819 5.62951 19.2359 5.89499L21.0361 7.04122C21.4496 7.30454 21.9983 7.18179 22.2603 6.76739V6.76739C22.5214 6.35428 22.3963 5.80636 21.9835 5.5448V5.5448M20.1312 4.37113L21.0748 2.86126C21.404 2.33445 22.0996 2.17707 22.6235 2.51084V2.51084C23.1501 2.84626 23.2999 3.54787 22.9563 4.0691L21.9835 5.5448M20.1312 4.37113L21.9835 5.5448"
                                stroke="#6B49FF"/>
                    </svg>
                    <span>Освящение прожекторами</span>
                </div>
                <div class="detail__content__benefits__field">
                    <svg class="icon-field" width="27" height="20" viewBox="0 0 27 20" fill="none"
                         xmlns="http://www.w3.org/2000/svg">
                        <path
                                d="M13.9512 3.85366H20.2683C22.4774 3.85366 24.2683 5.64452 24.2683 7.85366V8.02439M13.9512 3.85366H7.19512C4.98598 3.85366 3.19512 5.64452 3.19512 7.85366V8.02439M13.9512 3.85366V16.5854M13.9512 16.5854H7.19512C4.98598 16.5854 3.19512 14.7945 3.19512 12.5854V12.4146M13.9512 16.5854H20.2683C22.4774 16.5854 24.2683 14.7945 24.2683 12.5854V12.4146M3.19512 8.02439V8.02439C4.40745 8.02439 5.39024 9.00718 5.39024 10.2195V10.2195C5.39024 11.4318 4.40745 12.4146 3.19512 12.4146V12.4146M3.19512 8.02439V12.4146M24.2683 8.02439V8.02439C23.056 8.02439 22.0732 9.00718 22.0732 10.2195V10.2195C22.0732 11.4318 23.056 12.4146 24.2683 12.4146V12.4146M24.2683 8.02439V12.4146M13.7317 8.2439C10.849 8.24048 10.8941 12.6365 13.7317 12.6341M13.9512 8.2439C17.0244 8.2439 17.0244 12.6341 13.9512 12.6341M26.2439 5V15C26.2439 17.2091 24.453 19 22.2439 19H5C2.79086 19 1 17.2091 1 15V5C1 2.79086 2.79086 1 5 1H22.2439C24.453 1 26.2439 2.79086 26.2439 5Z"
                                stroke="#6B49FF"/>
                    </svg>
                    <span>Искусственное поле</span>
                </div>
            </div>

            {% include 'booking/components/_booking_form.html' %}

        </div>
    </div>

    <div id="map-test" class="detail__map"></div>
</header>

<script src="{% static 'booking/js/slider.js' %}"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script type="text/javascript" src="{% static 'booking/js/jquery.timepicker.js' %}"></script>
<script src="https://npmcdn.com/flatpickr/dist/flatpickr.min.js"></script>
<script src="https://npmcdn.com/flatpickr/dist/l10n/ru.js"></script>
<script>



    const dateInfo =  '';
    const timeInput = document.querySelector('.select-time');

	DateConfig = {
		altInput: true,
		altFormat: "F j, Y",
		dateFormat: "d.m.Y",
		"locale": "ru",
		minDate: "today",
		maxDate: new Date().fp_incr(14),
		disableMobile: "true",
		onChange: function (selectedDates, dateStr, instance) {
		    dateStr = String(dateStr)
		    {% if bookings|length != 0 %}
		    {% for booking_1 in bookings%}
		    if ('{{ booking_1.date|date:'d.m.Y' }}' == dateStr){
		        disabledTimes = [];
		        {% for booking_2 in bookings %}
                    {% if booking_2.date == booking_1.date %}
                        var time = [];
                        var timeStart = {{booking_2.time}};
                        var timeEnd = {{booking_2.time}} + 1;
                        time.push(`${timeStart}:00`, `${timeEnd}:00`);
                        disabledTimes.push(time);
                    {% endif %}
                {% endfor %}
            }else{
                disabledTimes = [];
            }
            {% endfor %}
            {% else %}
            disabledTimes = [];
            {% endif %}
            $(function () {
                $('#disableTimeRangesExample').timepicker({
                    'timeFormat': 'H:i',
                    'step': '60',
                    'show2400':	true,
                    'minTime': '7:00',
                    'maxTime': '23:00',
                    'disableTimeRanges': disabledTimes,
                });
            });

            timeInput.style.cursor = 'pointer';
            timeInput.title = '';
		},
	}
	flatpickr("input[class=form-control]", DateConfig);

    if (dateInfo === '') {
        timeInput.style.cursor = 'not-allowed';
        timeInput.title = 'Сначало выберите дату';
    }


    let center = [41.32145360231076,69.26054294711807];
		function init() {
			let map = new ymaps.Map('map-test', {
				center: center,
				zoom: 13
			}, {
				// Зададим ограниченную область прямоугольником,
				// примерно описывающим Санкт-Петербург.
				restrictMapArea: [
					[41.21995919178839,68.98802733956808],
					[41.42054917876853,69.51537108956808]
				]
			}),
			objectManager = new ymaps.ObjectManager({
					// Чтобы метки начали кластеризоваться, выставляем опцию.
					clusterize: true,
					// ObjectManager принимает те же опции, что и кластеризатор.
					gridSize: 32,
					clusterDisableClickZoom: true
				});

			// Чтобы задать опции одиночным объектам и кластерам,
			// обратимся к дочерним коллекциям ObjectManager.
			objectManager.objects.options.set('iconColor', '#6B49FF');
			objectManager.objects.options.set('icons', [[50, 50]]);
			objectManager.clusters.options.set('iconColor', '#6B49FF');
			map.geoObjects.add(objectManager);

            field = '{{ field.title }}'
			data = {
						"type": "FeatureCollection",
						"features": [
						    {% for field in fields %}
							{"type": "Feature", "id": {{ field.id }}, "geometry": {"type": "Point", "coordinates": [{{ field.adress_coordinates }}]}, "properties": {"balloonContentHeader": "<h5 class='map__cluster__title'>{{ field.title }}<h5><p class='map__cluster__free'>Свободен<p>", "balloonContentBody": "<div class='map__cluster__block'><p class='map__cluster__price'>{{ field.price }} 000 UZS / <span>час<span><p><a href='{{ field.get_absolute_url }}' class='map__cluster__btn'>Подробнее</a><div>", "balloonContentFooter": "", "clusterCaption": "<strong><s>Еще</s> одна</strong> метка", "hintContent": "<strong>Текст  <s>подсказки</s></strong>"}},
						    {% endfor %}
						]
					}

			objectManager.add(data);

			map.controls.remove('geolocationControl'); // удаляем геолокацию
			map.controls.remove('searchControl'); // удаляем поиск
			map.controls.remove('trafficControl'); // удаляем контроль трафика
			map.controls.remove('typeSelector'); // удаляем тип
			map.controls.remove('fullscreenControl'); // удаляем кнопку перехода в полноэкранный режим
			map.controls.remove('zoomControl'); // удаляем контрол зуммирования
			map.controls.remove('rulerControl'); // удаляем контрол правил
		}

		ymaps.ready(init);
    const screenWidth = screen.width;
    if (screenWidth < 576) {
        document.querySelector('.detail__content__selection__date-text span').innerHTML = 'Дата';
        document.querySelector('.detail__content__selection__time-text span').innerHTML = 'Время';
    }
</script>
{% endblock main %}